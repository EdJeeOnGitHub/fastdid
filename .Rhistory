table[variable == "DEATH_DOC_FIRST_YEAR"]
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in%drop_cols]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
View(means)
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_
View(sum_stat)
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR", "YEAR")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID"), c("COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR", "YEAR", "GROUP")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID"), c("COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR", "YEAR", "GROUP")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID"), c("COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "ID" & type == "Length") ]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("DEATH_LOCAL_DOC_COUNT", "ID"), c("LOCAL_DOC", "COUNT"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "DEATH_ID" & type == "Length") ]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("DEATH_LOCAL_DOC_COUNT", "DEATH_ID"), c("LOCAL_DOC", "COUNT"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "DEATH_ID" & type == "Length") ]
View(means)
View(table)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "PRSN_ID" & type == "Length") ]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("DEATH_LOCAL_DOC_COUNT", "PRSN_ID"), c("LOCAL_DOC", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
?kable
?kable
f <- function(a,b){a}
f(1)
f(1,2)
f <- function(a,b,c){ifelse(a,b,c)}
f(TRUE, 1)
f(FALSE, 1)
library(data.table)
library(knitr)
library(stringr)
library(clipr)
# parse RD ---------------------------------
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230905_H111235_蔡霖東/rd_results.csv"
library(data.table)
library(knitr)
library(stringr)
library(clipr)
# parse RD ---------------------------------
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/rd_sub.csv"
table <- fread(path)
head(table)
View(table)
library(ggplot2)
?geom_errorbar
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free")
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(xintercept = 0)) + theme_classic()
?geom_hline
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0)) + theme_classic()
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 200 & group == "main" & subset != "betelnut"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 200 & group == "main" & subset != "betelnut" & subset != "diab"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic()
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200.png", height = 10, width = 10)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200.png", height = 10, width = 10)
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho240.png", height = 10, width = 10)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/placebo_cutoff.csv"
table <- fread(path)
View(table)
table |> ggplot(aes(x = cutoff)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se))
View(table)
table |> ggplot(aes(x = cutoff)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 240, by subgroup")
table <- fread(path)
table[cutoff > 125] |> ggplot(aes(x = cutoff)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 240, by outcome")
table[cutoff > 125] |> ggplot(aes(x = cutoff)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") +
geom_vline(aes(xintercept = 160), linetype = "dashed", color = "red") +
geom_vline(aes(xintercept = 200), linetype = "dashed", color = "red") +
geom_vline(aes(xintercept = 240), linetype = "dashed", color = "red") +
theme_classic() +
labs(title = "Effect of CHO 240, by outcome")
table[cutoff > 130 & cutoff < 280] |> ggplot(aes(x = cutoff)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") +
geom_vline(aes(xintercept = 160), linetype = "dashed", color = "red") +
geom_vline(aes(xintercept = 200), linetype = "dashed", color = "red") +
geom_vline(aes(xintercept = 240), linetype = "dashed", color = "red") +
theme_classic() +
labs(title = "Effect of CHO 240, by outcome")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/placebo_cutoff.png", height = 10, width = 10)
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/placebo_cutoff.png", height = 10, width = 15)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/rd_sub.csv"
table <- fread(path)
View(table)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_lm.png", height = 10, width = 10)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_lm.png", height = 10, width = 10)
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho240_lm.png", height = 10, width = 10)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/rd_sub.csv"
table <- fread(path)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200.png", height = 10, width = 15)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_lm.png", height = 10, width = 15)
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho240.png", height = 10, width = 15)
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho240_lm.png", height = 10, width = 15)
table <- fread(path)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200.png", height = 10, width = 20)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_lm.png", height = 10, width = 20)
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho240.png", height = 10, width = 20)
table[cutoff == 240 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 240, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho240_lm.png", height = 10, width = 20)
?geom_line
?melt
table[cutoff == 200 & group == "main"] |> melt(neasure.vars = c("coef", "local_mean"))
table[cutoff == 200 & group == "main"] |> melt(neasure.vars = c("coef", "local_mean"))|> ggplot(aes(x = subset)) + geom_point(aes(y = value)) +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
table[cutoff == 200 & group == "main"] |> melt(neasure.vars = c("coef", "local_mean"))|> ggplot(aes(x = subset)) + geom_point(aes(y = value)) +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free"
table[cutoff == 200 & group == "main"] |> melt(neasure.vars = c("coef", "local_mean"))|> ggplot(aes(x = subset)) + geom_point(aes(y = value)) +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free")
table[cutoff == 200 & group == "main"] |> melt(neasure.vars = c("coef", "local_mean"))|> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
long <- table[cutoff == 200 & group == "main"] |> melt(neasure.vars = c("coef", "local_mean"))
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("coef", "local_mean"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("coef", "local_mean"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("coef", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("coef", "treat_potential"))
View(long)
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.10,"cm"), ends="first", type = "closed")) +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.10,"cm"), ends="first", type = "closed"), color = "red") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
?geom_line
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="last", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.10,"cm"), ends="last", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="last", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean around CHO 200, by subgroup")
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef/local_mean)) +
geom_errorbar(aes(ymin = (coef-1.96*se)/local_mean, ymax = (coef+1.96*se)/local)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef/local_mean)) +
geom_errorbar(aes(ymin = (coef-1.96*se)/local_mean, ymax = (coef+1.96*se)/local_mean)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="last", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean compared to treatment effect CHO 200, by subgroup")
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="last", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean compared to treatment effect CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_lm.png", height = 20, width = 10)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef/local_mean)) +
geom_errorbar(aes(ymin = (coef-1.96*se)/local_mean, ymax = (coef+1.96*se)/local_mean)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/local_relative_200.png", height = 10, width = 20)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200.png", height = 10, width = 20)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = local_mean)) +
facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Local mean around CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_lm.png", height = 10, width = 20)
table[, treat_potential := local_mean + coef]
long <- table[cutoff == 200 & group == "main"] |> melt(measure.vars = c("local_mean", "treat_potential"))
long |> ggplot(aes(x = subset, y = value)) + geom_point() +
geom_line(arrow = arrow(length=unit(0.30,"cm"), ends="last", type = "closed"), color = "red", linetype = "dashed") +
facet_wrap(~outcome, scales = "free") +
labs(title = "Local mean compared to treatment effect CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_compare.png", height = 20, width = 10)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef/local_mean)) +
geom_errorbar(aes(ymin = (coef-1.96*se)/local_mean, ymax = (coef+1.96*se)/local_mean)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/local_relative_200.png", height = 10, width = 20)
View(table)
table[cutoff == 200 & group == "next_check"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
table[cutoff == 200 & group == "next_check"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef/local_mean)) +
geom_errorbar(aes(ymin = (coef-1.96*se)/local_mean, ymax = (coef+1.96*se)/local_mean)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, by subgroup")
table[cutoff == 200 & group == "next_check"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef)) +
geom_errorbar(aes(ymin = coef-1.96*se, ymax = coef+1.96*se)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Effect of CHO 200, behavior outcome in next visit, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/cho200_be.png", height = 10, width = 20)
table[cutoff == 200 & group == "main"] |> ggplot(aes(x = subset)) + geom_point(aes(y = coef/local_mean)) +
geom_errorbar(aes(ymin = (coef-1.96*se)/local_mean, ymax = (coef+1.96*se)/local_mean)) + facet_wrap(~outcome, scales = "free") +
geom_hline(aes(yintercept = 0), linetype = "dashed", color = "red") + theme_classic() +
labs(title = "Relative Effect of CHO 200, by subgroup")
ggsave("G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230913_H111235_蔡霖東/local_relative_200.png", height = 10, width = 20)
rm(list = ls())
gc()
library(peakRAM)
library(microbenchmark)
library(profvis)
library(ggplot2)
setwd("~/GitHub/EventStudyCode")
# load event code ---------------------------------------------------------------------
source("source/sim_did.R")
source("source/utils.R")
source("source/setup.R")
source("source/get_event_result.R")
source("source/create_event_data.R")
source("source/plot_event_dynamics.R")
#old
#source("source_raw/eventcode_IV.r")
library(did)
library(DiDforBigData)
# ------------------------------------------------------------------------------------
get_dt <- function(sample_size, time_period){
simdt <- sim_did(sample_size, time_period, cov = "no", hetero = "all", balanced = FALSE, second_outcome = FALSE, seed = 1, stratify = FALSE)
dt <- simdt$dt
return(dt)
}
# functions for individual package call ---------------------------------------------
run_event_code <- function(sample_size, time_period){
dt <- get_dt(sample_size, time_period)
event_panel <- suppressWarnings(create_event_data(dt, timevar = "time", unitvar =  "unit",
cohortvar = "G",
#covariate_base_balance = "x",
covariate_base_stratify = "s",
control_group = "both", copy = FALSE, verbose = FALSE))
event_est_ce <- get_event_result(event_panel, variable = "y", trends = FALSE, mem.clean = FALSE, result_type = "dynamic")
}
run_dfbd <- function(sample_size, time_period){
dt <- get_dt(sample_size, time_period)
varnames = list()
varnames$time_name = "time"
varnames$outcome_name = "y"
varnames$cohort_name = "G"
varnames$id_name = "unit"
# estimate the ATT for all cohorts at event time 1 only
result <- DiD(dt, varnames)
return(result)
}
# start benchmarks ----------------------------------------------------------------------
profvis(run_event_code(100000,10))
