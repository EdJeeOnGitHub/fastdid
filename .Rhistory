csv_to_parquet_dataset <- function(in_folder, out_folder, overwrite = FALSE, filename, partition){
paths <- list.files(path = in_folder, pattern = filename, ignore.case = TRUE, full.names = TRUE)
dt <- open_dataset_fix_sch(paths) |> group_by(all_of(partition))
dt |> write_dataset(paste0(out_folder, "/", filename))
}
csv_to_parquet_dataset(csv_folder, arrow_path, filename = "OPDTE", partition = "FEE_YM")
?parse_expr
csv_to_parquet_dataset <- function(in_folder, out_folder, overwrite = FALSE, filename, partition){
paths <- list.files(path = in_folder, pattern = filename, ignore.case = TRUE, full.names = TRUE)
dt <- open_dataset_fix_sch(paths) |> group_by(!!rlang::parse_exprs(partition))
dt |> write_dataset(paste0(out_folder, "/", filename))
}
csv_to_parquet_dataset(csv_folder, arrow_path, filename = "OPDTE", partition = c("FEE_YM", "FUNC_TYPE"))
csv_to_parquet_dataset <- function(in_folder, out_folder, overwrite = FALSE, filename, partition){
paths <- list.files(path = in_folder, pattern = filename, ignore.case = TRUE, full.names = TRUE)
dt <- open_dataset_fix_sch(paths) |> group_by(!!rlang::parse_expr(partition))
dt |> write_dataset(paste0(out_folder, "/", filename))
}
csv_to_parquet_dataset(csv_folder, arrow_path, filename = "OPDTE", partition = "FEE_YM")
open_nhi_dt <- function(filename, parquet_path = Sys.getenv("ARROW_PATH")){
return(open_dataset(paste0(parquet_path, "/", filename)))
}
op <- open_nhi_dt("OPDTE")
op |> summarize(n = n()) |> collect()
sum <- op |> summarize(n = n()) |> collect()
sum$n
test_that("test arrow full dataset",{
unlink(arrow_folder, recursive = TRUE)
dir.create(arrow_folder)
csv_to_parquet_dataset(csv_folder, arrow_path, filename = "OPDTE", partition = "FEE_YM")
op <- open_nhi_dt("OPDTE")
sum <- op |> summarize(n = n()) |> collect()
expect_equal(sum$n, 1667307)
})
text <- "| NUM | FUNC_TYPE | COUNT_MEAN | YEARLY_RATIO | QUARTERLY_RATIO | PAIR_COUNT |
|-----|-----------|------------|--------------|-----------------|------------|
|   1 |        2B |       7.06 |         0.62 |            0.33 |        381 |
|   2 |        AB |       3.94 |         0.34 |            0.16 |      11723 |
|   3 |        AE |       3.63 |         0.33 |            0.14 |       7492 |
|   4 |        2A |       3.19 |         0.40 |            0.09 |        385 |
|   5 |        13 |       2.91 |         0.31 |            0.07 |       5159 |
|   6 |        12 |       2.88 |         0.28 |            0.09 |       7085 |
|   7 |        AD |       2.87 |         0.39 |            0.01 |       1806 |
|   8 |        AG |       2.76 |         0.29 |            0.08 |       2500 |
|   9 |        07 |       2.72 |         0.30 |            0.06 |       1100 |
|  10 |        AF |       2.63 |         0.22 |            0.08 |        790 |
|  11 |        14 |       2.62 |         0.27 |            0.06 |      8420 |
|  12 |        00 |       2.42 |         0.27 |            0.04 |    324169 |
|  13 |        BB |       2.24 |         0.51 |            0.00 |       441 |
|  14 |        02 |       2.20 |         0.21 |            0.04 |    189814 |
|  15 |        04 |       2.20 |         0.25 |            0.03 |     36855 |
|  16 |        08 |       2.20 |         0.17 |            0.04 |     11668 |
|  17 |        60 |       2.16 |         0.22 |            0.03 |    198662 |
|  18 |        01 |       2.12 |         0.21 |            0.03 |    166693 |
|  19 |        05 |       1.98 |         0.18 |            0.03 |     27546 |
|  20 |        AC |       1.97 |         0.16 |            0.04 |      2575 |
|  21 |        10 |       1.94 |         0.18 |            0.02 |     25542 |
|  22 |        BA |       1.93 |         0.21 |            0.02 |      6776 |
|  23 |        AA |       1.81 |         0.22 |            0.01 |      1906 |
|  24 |        11 |       1.78 |         0.16 |            0.01 |     65444 |
|  25 |        BD |       1.76 |         0.14 |            0.02 |      1338 |
|  26 |        06 |       1.66 |         0.12 |            0.01 |     36492 |
|  27 |        09 |       1.65 |         0.14 |            0.01 |     64460 |
|  28 |        40 |       1.62 |         0.14 |            0.00 |     75909 |
|  29 |        03 |       1.49 |         0.10 |            0.01 |     73380 |
|  30 |        22 |       1.09 |         0.01 |            0.00 |      3556 |"
library(stringr)
text2 <- text |> str_trim()
text2
text2 <- text |> str_trim(side = "both")
9e9
?glm
?lm
?interaction
library(cem)
data(LL)
todrop <- c("treated","re78")
imbalance(LL$treated, LL, drop=todrop)
mat <- cem(treatment="treated", data=LL, drop="re78")
mat$strata
?feols
library(data.table)
library(knitr)
library(stringr)
library(data.table)
library(knitr)
library(stringr)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/sum_death.csv"
table <- fread(path)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
head(table)
summary(table[, as.factor(type)])
table <- fread(path)
means <- table[type == "Mean"]
sum_stat <- dcast(table, formula = name ~ variable, value.var = "result")
table <- fread(path)
means <- table[type == "Mean"]
sum_stat <- dcast(table, formula = name ~ variable, value.var = "value")
View(sum_stat)
?dcast
means <- table[type == "Mean"]
sum_stat <- dcast(table, formula = name ~ variable, value.var = "value")
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
View(sum_stat)
View(means)
unique(table$variable)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
kable(sum_stat, format = "latex")
sum_stat <- transpose(sum_stat)
kable(sum_stat, format = "latex")
View(sum_stat)
?transpose
sum_stat <- transpose(sum_stat, make.names = 1)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat <- transpose(sum_stat, make.names = 1)
View(sum_stat)
kable(sum_stat, format = "latex")
library(clipr)
write_clip(kable(sum_stat, format = "latex"))
write_clip(kable(sum_stat, format = "latex"))
View(sum_stat)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
?transpose
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
setorder(sum_stat, name)
View(sum_stat)
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
View(means)
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
View(sum_stat)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, "DEATH_LOCAL_DOC_COUNT", "LOCAL_DOC")
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")]
View(means)
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
View(sum_stat)
means <- table[type == "Mean" & !variable %in% c("DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM")]
means[, ID_S := ID_S - 1]
means <- table[type == "Mean" & !variable %in% c("DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM")]
means[, ID_S := ID_S - 1]
names(means)
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, "ID_S", "MALE")
View(table)
View(means)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, "ID_S", "MALE")
View(sum_stat)
means <- table[type == "Mean" & !variable %in% c("DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, "ID_S", "MALE")
means <- table[type == "Mean" & !variable %in% c("SAME_FUNC_TREAT_DOC", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, "ID_S", "MALE")
setorder(sum_stat, name)
View(sum_stat)
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("SAME_FUNC_TREAT_DOC", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[, value := round(value, 3)]
means <- table[type == "Mean" & !variable %in% c("SAME_FUNC_TREAT_DOC", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[, value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
setnames(sum_stat, "ID_S", "MALE")
setorder(sum_stat, name)
View(sum_stat)
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[, value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
setnames(sum_stat, "ID_S", "MALE")
setorder(sum_stat, name)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[, value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
setnames(sum_stat, "ID_S", "MALE")
setorder(sum_stat, name)
View(sum_stat)
View(table)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[, value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
setnames(sum_stat, "ID_S", "MALE")
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
View(sum_stat)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(ID_S - 1)]
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S - 1))]
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
table <- fread(path)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("DEATH_DOC_FIRST_YEAR","ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in% c("DEATH_DOC_FIRST_YEAR","ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_YEAR", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")]
means[type != "Length", value := round(as.numeric(value), 3)]
View(means)
table[variable == ""DEATH_DOC_FIRST_YEAR""]
table[variable == "DEATH_DOC_FIRST_YEAR"]
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" | (variable == "ID" & type == "Length") & !variable %in%drop_cols]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/pat_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
sum_stat[, ID_S := 1-(as.numeric(ID_S) - 1)]
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("ID_BIRTHYM","DEATH_YEAR", "DEATH_DOC_FIRST_YEAR","YEAR","SAME_FUNC_TREAT_DOT", "DEATH_DOC_FIRST_YEAR", "ID_BIRTHYM", "NEW_DOC_VISIT", "OLD_BOY_VISIT", "SAME_FUNC_TREAT_DOC", "TREAT_DOT")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE")
means <- table[type == "Mean" & !variable %in%drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
View(means)
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
#setnames(sum_stat, c("ID_S", "ID"), c("MALE", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_
View(sum_stat)
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR", "YEAR")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID"), c("COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR", "YEAR", "GROUP")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID"), c("COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
View(sum_stat)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/coworker_sum.csv"
table <- fread(path)
table[, variable := str_trim(variable)]
drop_cols <- c("AGE", "COWORK_FIRST", "COWORK_LAST", "DEATH_YEAR", "YEAR", "GROUP")
means <- table[type == "Mean" & !variable %in% drop_cols | (variable == "ID" & type == "Length") ]
means[type != "Length", value := round(as.numeric(value), 3)]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("ID"), c("COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "ID" & type == "Length") ]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("DEATH_LOCAL_DOC_COUNT", "ID"), c("LOCAL_DOC", "COUNT"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "DEATH_ID" & type == "Length") ]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("DEATH_LOCAL_DOC_COUNT", "DEATH_ID"), c("LOCAL_DOC", "COUNT"))
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "DEATH_ID" & type == "Length") ]
View(means)
View(table)
path <- "G:/我的雲端硬碟/Obsidian/Source/NHIRD/20230906_H111235_蔡霖東/death_sum.csv"
table <- fread(path)
means <- table[type == "Mean" & !variable %in% c("YEAR", "GROUP", "DEATH_CITY", 'DEATH_YEAR', "LAST_ACTIVE_YEAR", "LAST_FUNC_SIZE", "DEATH_BIRTHY")| (variable == "PRSN_ID" & type == "Length") ]
sum_stat <- dcast(means, formula = name ~ variable, value.var = "value")
setnames(sum_stat, c("DEATH_LOCAL_DOC_COUNT", "PRSN_ID"), c("LOCAL_DOC", "COUNT"))
setorder(sum_stat, name)
sum_stat <- transpose(sum_stat, make.names = 1, keep.names = "variable")
write_clip(kable(sum_stat, format = "latex"))
?kable
?kable
library(rlist)
?list.select
ll <- list(a = data.table(x = 1:10), b = data.table(y = 1:10))
library(data.table)
ll <- list(a = data.table(x = 1:10), b = data.table(y = 1:10))
ll
get(ll, "a")
?list
?get
get("a", envir = ll)
ll["a"]
rm(list = ls())
gc()
library(profvis)
library(microbenchmark)
setwd("~/GitHub/EventStudyCode")
source("sim_did.R")
source("source/setup.R")
# simulation ---------------------------------------------------------------------
#test with did
simdt <- sim_did(1000, 10, cov = "int", hetero = "dynamic", balanced = FALSE, second_outcome = FALSE)
dt <- simdt$dt
source("source/preprocess.R")
source("source/estimation.R")
source("source/report.R")
event_panel <- copy(dt) #copying so that the original does not change
min_time <- -Inf
max_time <- Inf
y_name <- c("y")
t_name <- "time"
unit_name <- "unit"
cohort_name <- "G"
balance_covariate <- "x"
event_panel <- event_panel %>% create_event_data(timevar = t_name, unitvar = unit_name,
cohortvar = cohort_name,
covariate_base_balance = balance_covariate,
balanced_panel = TRUE,
never_treat_action = "both")
event_est <- get_result_dynamic(event_panel, variable = y_name, trends = FALSE, mem.clean = FALSE)
View(event_est)
rm(list = ls())
gc()
library(profvis)
library(microbenchmark)
setwd("~/GitHub/EventStudyCode")
source("sim_did.R")
source("source/setup.R")
# simulation ---------------------------------------------------------------------
#test with did
simdt <- sim_did(1000, 10, cov = "int", hetero = "dynamic", balanced = FALSE, second_outcome = FALSE)
dt <- simdt$dt
# new event code ---------------------------------------------------------------------
source("source/preprocess.R")
source("source/estimation.R")
source("source/report.R")
event_panel <- copy(dt) #copying so that the original does not change
min_time <- -Inf
max_time <- Inf
y_name <- c("y")
t_name <- "time"
unit_name <- "unit"
cohort_name <- "G"
balance_covariate <- "x"
event_panel <- event_panel %>% create_event_data(timevar = t_name, unitvar = unit_name,
cohortvar = cohort_name,
covariate_base_balance = balance_covariate,
balanced_panel = TRUE,
never_treat_action = "both")
event_est <- get_result_dynamic(event_panel, variable = y_name, trends = FALSE, mem.clean = FALSE)
View(event_est)
